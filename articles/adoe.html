<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating ADOE â€¢ admiralophtha</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating ADOE">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiralophtha</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/admiralophtha.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><a class="dropdown-item" href="../articles/standards.html">Ophthalmology Standards</a></li>
    <li><a class="dropdown-item" href="../articles/adoe.html">Creating ADOE</a></li>
    <li><a class="dropdown-item" href="../articles/adbcva.html">Creating ADBCVA</a></li>
    <li><a class="dropdown-item" href="../articles/advfq.html">Creating ADVFQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/website-versions.html" aria-label="Previous Release Websites"><span class="fa fa-history"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiralophtha/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiralophtha" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="adoe_files/dt-scroll-1.0.0/style.css" rel="stylesheet">
<script src="adoe_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="adoe_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="adoe_files/datatables-binding-0.33/datatables.js"></script><link href="adoe_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="adoe_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="adoe_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="adoe_files/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="adoe_files/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js"></script><script src="adoe_files/dt-ext-buttons-1.13.6/js/buttons.html5.min.js"></script><script src="adoe_files/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js"></script><script src="adoe_files/dt-ext-buttons-1.13.6/js/buttons.print.min.js"></script><link href="adoe_files/dt-ext-colreorder-1.13.6/css/colReorder.dataTables.min.css" rel="stylesheet">
<script src="adoe_files/dt-ext-colreorder-1.13.6/js/dataTables.colReorder.min.js"></script><link href="adoe_files/dt-ext-scroller-1.13.6/css/scroller.dataTables.min.css" rel="stylesheet">
<script src="adoe_files/dt-ext-scroller-1.13.6/js/dataTables.scroller.min.js"></script><link href="adoe_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="adoe_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="adoe_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="adoe_files/selectize-0.12.0/selectize.min.js"></script><link href="adoe_files/dt-plugin-searchhighlight-1.13.6/source.css" rel="stylesheet">
<script src="adoe_files/dt-plugin-searchhighlight-1.13.6/jquery.highlight.js"></script><script src="adoe_files/dt-plugin-searchhighlight-1.13.6/source.min.js"></script><link href="adoe_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="adoe_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating ADOE</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiralophtha/blob/main/vignettes/adoe.Rmd" class="external-link"><code>vignettes/adoe.Rmd</code></a></small>
      <div class="d-none name"><code>adoe.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article describes creating an ADOE ADaM with Ophthalmology Exam
Analysis data for ophthalmology endpoints. It is to be used in
conjunction with the article on <a href="https://pharmaverse.github.io/admiral/articles/bds_finding.html" class="external-link">creating
a BDS dataset from SDTM</a>. As such, derivations and processes that are
not specific to ADOE are absent, and the user is invited to consult the
aforementioned article for guidance.</p>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM
format as input unless otherwise specified.</em></p>
<div class="section level3">
<h3 id="dataset-contents">Dataset Contents<a class="anchor" aria-label="anchor" href="#dataset-contents"></a>
</h3>
<p><a href="https://pharmaverse.github.io/admiralophtha/">admiralophtha</a> suggests to populate ADOE with general
miscellaneous ophthalmology parameters. Any efficacy endpoint-related
parameters (eg. BCVA tests) should be placed in separate datasets (eg.
ADBCVA).</p>
</div>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>The examples of this vignette require the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/pharmaversesdtm/" class="external-link">pharmaversesdtm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiraldev/" class="external-link">admiraldev</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiralophtha/">admiralophtha</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="programming-workflow">Programming Workflow<a class="anchor" aria-label="anchor" href="#programming-workflow"></a>
</h2>
<ul>
<li><a href="#setup">Initial Set Up of ADOE</a></li>
<li><a href="#further">Further Derivations of Standard BDS
Variables</a></li>
<li><a href="#example">Example Script</a></li>
</ul>
<div class="section level3">
<h3 id="setup">Initial set up of ADOE<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>As with all BDS ADaM datasets, one should start from the OE SDTM,
where only the general ophthalmology records are of interest. For the
purposes of the next two sections, we shall be using the
<a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> OE and ADSL test data. We will also require a
lookup table for the mapping of parameter codes.</p>
<p><strong>Note</strong>: to simulate an ophthalmology study, we add a
randomly generated <code>STUDYEYE</code> variable to ADSL, but in
practice <code>STUDYEYE</code> will already have been derived using
<code><a href="../reference/derive_var_studyeye.html">derive_var_studyeye()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"oe_ophtha"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"admiral_adsl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add STUDYEYE to ADSL to simulate an ophtha dataset</span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="va">admiral_adsl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>STUDYEYE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/convert_blanks_to_na.html">convert_blanks_to_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">oe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/convert_blanks_to_na.html">convert_blanks_to_na</a></span><span class="op">(</span><span class="va">oe_ophtha</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Lookup table</span></span>
<span></span>
<span><span class="co"># nolint start</span></span>
<span><span class="va">param_lookup</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">OETESTCD</span>, <span class="op">~</span><span class="va">OECAT</span>, <span class="op">~</span><span class="va">OESCAT</span>, <span class="op">~</span><span class="va">AFEYE</span>, <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">PARAM</span>, <span class="op">~</span><span class="va">PARAMN</span>,</span>
<span>  <span class="st">"CSUBTH"</span>, <span class="st">"OPHTHALMIC ASSESSMENTS"</span>, <span class="st">"SD-OCT CST SINGLE FORM"</span>, <span class="st">"Study Eye"</span>, <span class="st">"SCSUBTH"</span>, <span class="st">"Study Eye Center Subfield Thickness (um)"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"CSUBTH"</span>, <span class="st">"OPHTHALMIC ASSESSMENTS"</span>, <span class="st">"SD-OCT CST SINGLE FORM"</span>, <span class="st">"Fellow Eye"</span>, <span class="st">"FCSUBTH"</span>, <span class="st">"Fellow Eye Center Subfield Thickness (um)"</span>, <span class="fl">2</span>,</span>
<span>  <span class="st">"DRSSR"</span>, <span class="st">"OPHTHALMIC ASSESSMENTS"</span>, <span class="st">"SD-OCT CST SINGLE FORM"</span>, <span class="st">"Study Eye"</span>, <span class="st">"SDRSSR"</span>, <span class="st">"Study Eye Diabetic Retinopathy Severity"</span>, <span class="fl">3</span>,</span>
<span>  <span class="st">"DRSSR"</span>, <span class="st">"OPHTHALMIC ASSESSMENTS"</span>, <span class="st">"SD-OCT CST SINGLE FORM"</span>, <span class="st">"Fellow Eye"</span>, <span class="st">"FDRSSR"</span>, <span class="st">"Fellow Eye Diabetic Retinopathy Severity"</span>, <span class="fl">4</span>,</span>
<span>  <span class="st">"IOP"</span>, <span class="st">"INTRAOCULAR PRESSURE"</span>, <span class="cn">NA_character_</span>, <span class="st">"Study Eye"</span>, <span class="st">"SIOP"</span>, <span class="st">"Study Eye IOP (mmHg)"</span>, <span class="fl">5</span>,</span>
<span>  <span class="st">"IOP"</span>, <span class="st">"INTRAOCULAR PRESSURE"</span>, <span class="cn">NA_character_</span>, <span class="st">"Fellow Eye"</span>, <span class="st">"FIOP"</span>, <span class="st">"Fellow Eye IOP (mmHg)"</span>, <span class="fl">6</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># nolint end</span></span></code></pre></div>
<p>Following this setup, the programmer can start constructing ADOE. The
first step is to subset OE to only general ophthalmology parameters.
Then, one can merge the resulting dataset with ADSL. This is required
for two reasons: firstly, <code>STUDYEYE</code> is crucial in the
mapping of <code>AFEYE</code> and <code>PARAMCD</code>â€™s. Secondly, the
treatment start date (<code>TRTSDT</code>) is also a prerequisite for
the derivation of variables such as Analysis Day (<code>ADY</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">TRTSDT</span>, <span class="va">TRTEDT</span>, <span class="va">TRT01A</span>, <span class="va">TRT01P</span>, <span class="va">STUDYEYE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adoe</span> <span class="op">&lt;-</span> <span class="va">oe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">OETESTCD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CSUBTH"</span>, <span class="st">"DRSSR"</span>, <span class="st">"IOP"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_vars_merged.html">derive_vars_merged</a></span><span class="op">(</span></span>
<span>    dataset_add <span class="op">=</span> <span class="va">adsl</span>,</span>
<span>    new_vars <span class="op">=</span> <span class="va">adsl_vars</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The next item of business is to derive <code>AVAL</code>,
<code>AVALU</code>, and <code>DTYPE</code>. In this example, due to the
small number of parameters their derivation is trivial.
<code>AFEYE</code> is also created in this step using the function
<code><a href="../reference/derive_var_afeye.html">derive_var_afeye()</a></code>. To determine the affected eye, this
function compares <code>OELAT</code> to the <code>STUDYEYE</code>
variable created from the previous step.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adoe</span> <span class="op">&lt;-</span> <span class="va">adoe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Calculate AVAL, AVALC, AVALU and DTYPE</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    AVAL <span class="op">=</span> <span class="va">OESTRESN</span>,</span>
<span>    AVALC <span class="op">=</span> <span class="va">OESTRESC</span>,</span>
<span>    AVALU <span class="op">=</span> <span class="va">OESTRESU</span>,</span>
<span>    DTYPE <span class="op">=</span> <span class="cn">NA_character_</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Derive AFEYE needed for PARAMCD derivation</span></span>
<span>  <span class="fu"><a href="../reference/derive_var_afeye.html">derive_var_afeye</a></span><span class="op">(</span>loc_var <span class="op">=</span> <span class="va">OELOC</span>, lat_var <span class="op">=</span> <span class="va">OELAT</span>, loc_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EYE"</span>, <span class="st">"RETINA"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="param_avisit">Assigning <code>PARAM</code>/<code>PARAMCD</code> and
<code>AVISIT/AVISITN</code><a class="anchor" aria-label="anchor" href="#param_avisit"></a>
</h3>
<p>Moving forwards, <code>PARAM</code> and <code>PARAMCD</code> can be
assigned using <code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_vars_merged.html">derive_vars_merged()</a></code> from
<a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> and the lookup table <code>param_lookup</code>
generated above. <code>AVISIT</code>, <code>AVISITN</code> and related
timepoint variables can also be derived soon after, though their
derivation is generally study-specific. A simple option is included
below; please consult the <a href="https://pharmaverse.github.io/admiral/" class="external-link">admiral</a> <a href="https://pharmaverse.github.io/admiral/articles/bds_finding.html#timing" class="external-link">BDS
findings vignette</a> for a more detailed discussion.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adoe</span> <span class="op">&lt;-</span> <span class="va">adoe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add PARAM, PARAMCD from lookup table</span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_vars_merged.html">derive_vars_merged</a></span><span class="op">(</span></span>
<span>    dataset_add <span class="op">=</span> <span class="va">param_lookup</span>,</span>
<span>    new_vars <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">PARAM</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">OETESTCD</span>, <span class="va">AFEYE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Derive visit, baseline flag info and BASETYPE</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ATPTN <span class="op">=</span> <span class="va">OETPTNUM</span>,</span>
<span>    ATPT <span class="op">=</span> <span class="va">OETPT</span>,</span>
<span>    AVISIT <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">VISIT</span>, <span class="st">"SCREEN"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Screening"</span>,</span>
<span>      <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">VISIT</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_title</a></span><span class="op">(</span><span class="va">VISIT</span><span class="op">)</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    AVISITN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">VISITNUM</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    ABLFL <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"Baseline"</span>, <span class="st">"Y"</span>, <span class="cn">NA_character_</span><span class="op">)</span></span>
<span>    <span class="co"># In actual studies, ABLFL derivation will likely be more nuanced</span></span>
<span>    <span class="co"># and leverage derive_var_extreme_flag()</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="params">Creating IOP pre to post-dose difference derived parameter<a class="anchor" aria-label="anchor" href="#params"></a>
</h3>
<p>Two derived parameters of interest are the difference between pre and
post-dose IOP in each eye at each visit. These records can be added with
two calls to <code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_param_computed.html">derive_param_computed()</a></code>. Since the calls are
very similar, they can be executed in one code block using
<code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/call_derivation.html">call_derivation()</a></code> - please see the <a href="https://pharmaverse.github.io/admiral/articles/higher_order.html" class="external-link">Higher
Order Functions vignette</a> for more details.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adoe</span> <span class="op">&lt;-</span> <span class="va">adoe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add derived parameter for difference between pre and post dose IOP</span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/call_derivation.html">call_derivation</a></span><span class="op">(</span></span>
<span>    derivation <span class="op">=</span> <span class="va">derive_param_computed</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span>, <span class="op">!</span><span class="op">!</span><span class="va">adsl_vars</span>, <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">AVISIT</span>, <span class="va">AVISITN</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    variable_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="co"># Study eye</span></span>
<span>      <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/params.html">params</a></span><span class="op">(</span></span>
<span>        parameters <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span></span>
<span>          SIOPPRE <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"SIOP"</span> <span class="op">&amp;</span> <span class="va">ATPT</span> <span class="op">==</span> <span class="st">"PRE-DOSE"</span>,</span>
<span>          SIOPPOST <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"SIOP"</span> <span class="op">&amp;</span> <span class="va">ATPT</span> <span class="op">==</span> <span class="st">"POST-DOSE"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        set_values_to <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span></span>
<span>          PARAMCD <span class="op">=</span> <span class="st">"SIOPCHG"</span>,</span>
<span>          PARAM <span class="op">=</span> <span class="st">"Study Eye IOP Pre to Post Dose Diff (mmHg)"</span>,</span>
<span>          PARAMN <span class="op">=</span> <span class="fl">9</span>,</span>
<span>          AVAL <span class="op">=</span> <span class="va">AVAL.SIOPPOST</span> <span class="op">-</span> <span class="va">AVAL.SIOPPRE</span>,</span>
<span>          AVALC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">AVAL</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="co"># Fellow eye</span></span>
<span>      <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/params.html">params</a></span><span class="op">(</span></span>
<span>        parameters <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span></span>
<span>          FIOPPRE <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"FIOP"</span> <span class="op">&amp;</span> <span class="va">ATPT</span> <span class="op">==</span> <span class="st">"PRE-DOSE"</span>,</span>
<span>          FIOPPOST <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"FIOP"</span> <span class="op">&amp;</span> <span class="va">ATPT</span> <span class="op">==</span> <span class="st">"POST-DOSE"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        set_values_to <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span></span>
<span>          PARAMCD <span class="op">=</span> <span class="st">"FIOPCHG"</span>,</span>
<span>          PARAM <span class="op">=</span> <span class="st">"Fellow Eye IOP Pre to Post Dose Diff (mmHg)"</span>,</span>
<span>          PARAMN <span class="op">=</span> <span class="fl">10</span>,</span>
<span>          AVAL <span class="op">=</span> <span class="va">AVAL.FIOPPOST</span> <span class="op">-</span> <span class="va">AVAL.FIOPPRE</span>,</span>
<span>          AVALC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">AVAL</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:auto;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;01-701-1028&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Baseline&quot;,&quot;Week 4&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;FIOP&quot;,&quot;FIOPCHG&quot;,&quot;SIOP&quot;,&quot;SIOPCHG&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-18\" data-max=\"26\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons","ColReorder","Scroller"],"data":[["01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028","01-701-1028"],["Baseline","Baseline","Baseline","Baseline","Baseline","Baseline","Week 4","Week 4","Week 4","Week 4","Week 4","Week 4"],["FIOP","SIOP","FIOP","SIOP","SIOPCHG","FIOPCHG","FIOP","SIOP","FIOP","SIOP","SIOPCHG","FIOPCHG"],[25,19,7,20,1,-18,10,19,13,26,7,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>USUBJID<\/th>\n      <th>AVISIT<\/th>\n      <th>PARAMCD<\/th>\n      <th>AVAL<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":[],"visible":false},{"className":"dt-right","targets":3},{"name":"USUBJID","targets":0},{"name":"AVISIT","targets":1},{"name":"PARAMCD","targets":2},{"name":"AVAL","targets":3}],"searchHighlight":true,"searching":true,"pageLength":5,"lengthMenu":[5,10,15,20,50,100],"dom":"<Bfr<\"dt-scroll\"t>ipl>","buttons":[{"extend":"colvis","text":"Choose the columns to display","scroller":true,"collectionLayout":"fixed two-column"}],"colReorder":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><p>Note that within the call to <code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_param_computed.html">derive_param_computed()</a></code>,
the <code>parameters</code> argument has been used to pass an expression
that uniquely identifies which records are the pre-dose IOP and which
are the post-dose IOP using the timepoint variable <code>OETPT</code>,
because all IOP records are mapped to <code>PARAMCD = "SIOP"</code> or
<code>PARAMCD = "FIOP"</code>. Users may need to update this expression
if their study-specific collection or mapping differs from this
standard.</p>
<p>Additionally, it should be noted that for the <code>SIOPCHG</code>
and <code>FIOPCHG</code> derived parameters, it is generally recommended
not to populate <code>BASE</code>, <code>CHG</code> and
<code>PCHG</code> as they are difficult/confusing to interpret. This can
be simply achieved in one step, as the derivation of
<code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_var_base.html">derive_var_base()</a></code> can be placed inside of
<code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/restrict_derivation.html">restrict_derivation()</a></code> with a filter added to exclude these
parameters. Then, <code>BASE</code> will be set to <code>NA</code> for
<code>SIOPCHG</code> and <code>FIOPCHG</code>, so later calls to
<code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_var_chg.html">derive_var_chg()</a></code> and <code><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/derive_var_pchg.html">derive_var_pchg()</a></code> do not
need any changes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adoe</span> <span class="op">&lt;-</span> <span class="va">adoe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Calculate BASE (do not derive for IOP change params)</span></span>
<span>  <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/restrict_derivation.html">restrict_derivation</a></span><span class="op">(</span></span>
<span>    derivation <span class="op">=</span> <span class="va">derive_var_base</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/params.html">params</a></span><span class="op">(</span></span>
<span>      by_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https:/pharmaverse.github.io/admiral/v1.3.0/cran-release/reference/get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span>, <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">PARAMCD</span>, <span class="va">ATPT</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      source_var <span class="op">=</span> <span class="va">AVAL</span>,</span>
<span>      new_var <span class="op">=</span> <span class="va">BASE</span></span>
<span>    <span class="op">)</span>,</span>
<span>    filter <span class="op">=</span> <span class="op">!</span><span class="va">PARAMCD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SIOPCHG"</span>, <span class="st">"FIOPCHG"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="further">Further Derivations of Standard BDS Variables<a class="anchor" aria-label="anchor" href="#further"></a>
</h3>
<p>The user is invited to consult the article on <a href="https://pharmaverse.github.io/admiral/articles/bds_finding.html" class="external-link">creating
a BDS dataset from SDTM</a> to learn how to add standard BDS variables
to ADOE.</p>
</div>
<div class="section level3">
<h3 id="example">Example Script<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<table class="table">
<colgroup>
<col width="22%">
<col width="77%">
</colgroup>
<thead><tr class="header">
<th>ADaM</th>
<th>Sample Code</th>
</tr></thead>
<tbody><tr class="odd">
<td>ADOE</td>
<td><a href="https://github.com/pharmaverse/admiralophtha/blob/main/inst/templates/ad_adoe.R" class="external-link">ad_adoe.R</a></td>
</tr></tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edoardo Mancini, Ritika Aggarwal, Jane Gao, William Holmes, Josie Jackson, Sonali Jain, Yuki Matsunaga, Gordon Miller, Rachel Linacre, Lucy Palmen, Nandini R Thampi, Aldrich Salva, Steven Ting.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
